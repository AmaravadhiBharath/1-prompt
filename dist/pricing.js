import{a as g,c as h}from"./firebase.js";const c={guest:{tier:"guest",maxCaptures:-1,maxCompiles:-1,hasHistory:!1,canEdit:!0,hasGenerateMode2:!1,requiresAuth:!1,deviceLocked:!0,canPin:!1},free:{tier:"free",maxCaptures:-1,maxCompiles:-1,hasHistory:!0,canEdit:!0,hasGenerateMode2:!1,requiresAuth:!0,deviceLocked:!1,canPin:!0},go:{tier:"go",maxCaptures:-1,maxCompiles:-1,hasHistory:!0,canEdit:!0,hasGenerateMode2:!1,requiresAuth:!0,deviceLocked:!1,canPin:!0},pro:{tier:"pro",maxCaptures:-1,maxCompiles:-1,hasHistory:!0,canEdit:!0,hasGenerateMode2:!0,requiresAuth:!0,deviceLocked:!1,canPin:!0},infi:{tier:"infi",maxCaptures:-1,maxCompiles:-1,hasHistory:!0,canEdit:!0,hasGenerateMode2:!0,requiresAuth:!0,deviceLocked:!1,canPin:!0},admin:{tier:"admin",maxCaptures:-1,maxCompiles:-1,hasHistory:!0,canEdit:!0,hasGenerateMode2:!0,requiresAuth:!0,deviceLocked:!1,canPin:!0}},y={regularPrice:9,offerPrice:5,currency:"USD",billingPeriod:"month"};async function p(){try{const t=(await chrome.storage.local.get(["promptExtractor_user"])).promptExtractor_user;if(!t)return"guest";const a="tierCache",i=(await chrome.storage.local.get([a]))[a],u=Date.now(),f=5*60*1e3;if(i&&i.userId===t.id&&u-i.timestamp<f)return i.tier;const l=await g(),m={"Content-Type":"application/json"};l&&(m.Authorization=`Bearer ${l}`);const d=await fetch(`${h.backend.url}/user/tier`,{method:"POST",headers:m,body:JSON.stringify({userId:t.id,email:t.email})});if(!d.ok)throw new Error("Tier check failed");const n=(await d.json()).tier;return await chrome.storage.local.set({[a]:{tier:n,timestamp:u,userId:t.id},userTier:n}),n}catch(e){return console.error("[Pricing] Tier check error:",e),(await chrome.storage.local.get(["userTier"])).userTier||"guest"}}async function x(){await chrome.storage.local.remove(["tierCache"])}function P(){let e=localStorage.getItem("deviceId");return e||(e=crypto.randomUUID(),localStorage.setItem("deviceId",e)),e}const o="daily_usage_stats";async function s(){return new Promise(e=>{chrome.storage.local.get([o],t=>{const a=new Date().toLocaleDateString("en-CA"),r=t[o];if(!r||r.date!==a){const i={date:a,captures:0,compiles:0};chrome.storage.local.set({[o]:i}),e(i)}else e(r)})})}async function I(){const e=await p(),t=c[e].maxCaptures;if(t===-1)return{allowed:!0};const a=await s(),r=t-a.captures;return r<=0?{allowed:!1,reason:"Daily capture limit reached. Sign in for unlimited captures!"}:{allowed:!0,remaining:r}}async function T(){const e=await p(),t=c[e].maxCompiles;if(t===-1)return{allowed:!0};if(t===0)return{allowed:!1,reason:"Compiling is available on Go and Pro plans. Sign in to try!"};const a=await s(),r=t-a.compiles;return r<=0?{allowed:!1,reason:"Daily compile limit reached. Upgrade to Pro for unlimited compiles!"}:{allowed:!0,remaining:r}}async function k(){const e=await s();e.captures+=1,await chrome.storage.local.set({[o]:e})}async function E(){const e=await s();e.compiles+=1,await chrome.storage.local.set({[o]:e})}function v(e){const t=c[e];let a="Pro";return e==="guest"?a="Basic":(e==="free"||e==="go")&&(a="Go"),{...t,displayName:a,captureText:t.maxCaptures===-1?"Unlimited Captures":`${t.maxCaptures}/day Captures`,compileText:t.maxCompiles===-1?"Unlimited Compiles":t.maxCompiles===0?"No Compiles":`${t.maxCompiles}/day Compiles`}}export{c as PRICING_TIERS,y as PRO_PRICING,I as canUserCapture,T as canUserCompile,P as getDeviceId,v as getTierFeatures,p as getUserTier,k as incrementCapture,E as incrementCompile,x as invalidateTierCache};

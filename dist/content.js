var Ue=Object.defineProperty;var De=(b,y,A)=>y in b?Ue(b,y,{enumerable:!0,configurable:!0,writable:!0,value:A}):b[y]=A;var h=(b,y,A)=>De(b,typeof y!="symbol"?y+"":y,A);(function(){"use strict";const b={backend:{url:"https://1prompt-backend.amaravadhibharath.workers.dev"},features:{telemetryEnabled:!0,remoteSelectorEnabled:!0},analytics:{posthogKey:"",posthogHost:"https://us.i.posthog.com"},email:{resendKey:""},ai:{defaultProvider:"auto",model:""}};class y{constructor(){h(this,"config",b);h(this,"loaded",!1)}async load(){if(this.loaded)return this.config;try{const t=await fetch(`${b.backend.url}/config/runtime`);if(t.ok){const o=(await t.json()).config;this.config=this.mergeConfig(b,o),console.log("[Config] Loaded runtime config from Backend")}}catch{console.log("[Config] Using bundled config")}return this.loaded=!0,this.config}mergeConfig(t,e){return{backend:{...t.backend,...e.backend},features:{...t.features,...e.features},analytics:{...t.analytics,...e.analytics},email:{...t.email,...e.email},ai:{...t.ai,...e.ai}}}get backend(){return this.config.backend}get features(){return this.config.features}get analytics(){return this.config.analytics}get email(){return this.config.email}get ai(){return this.config.ai}}const A=new y,k="prompt_extractor_selectors",I=3600*1e3;class ae{constructor(){h(this,"registry",null)}async getSelectors(t){const e=await this.getRegistry();if(e.platforms[t])return e.platforms[t];for(const o of Object.keys(e.platforms))if(t.includes(o)||o.includes(t))return e.platforms[o];return null}async getRegistry(){if(this.registry&&Date.now()-this.registry.lastUpdated<I)return this.registry;const t=await this.loadFromStorage();if(t&&Date.now()-t.lastUpdated<I)return this.registry=t,Date.now()-t.lastUpdated>I*.5&&this.fetchFromBackend().catch(e=>console.warn("[SelectorRegistry] Background refresh failed",e)),t;try{const e=await this.fetchFromBackend();return this.registry=e,e}catch(e){return console.warn("[SelectorRegistry] Fetch failed, using cache/fallback",e),t||this.formattedBundledDefaults()}}async fetchFromBackend(){const t=A.backend.url||"https://1prompt-backend.amaravadhibharath.workers.dev",e=await fetch(`${t}/config/selectors`);if(!e.ok)throw new Error(`Failed to fetch selectors: ${e.status}`);const s={platforms:(await e.json()).config.platforms,lastUpdated:Date.now()};return await this.saveToStorage(s),s}async loadFromStorage(){return new Promise(t=>{chrome.storage.local.get(k,e=>{t(e[k]||null)})})}async saveToStorage(t){return new Promise(e=>{chrome.storage.local.set({[k]:t},e)})}formattedBundledDefaults(){return{lastUpdated:Date.now(),platforms:{"chatgpt.com":{promptSelectors:[".whitespace-pre-wrap","div[data-message-author-role='user']","article div.flex-col.gap-1"],excludeSelectors:[".sr-only","button","svg"]},"claude.ai":{promptSelectors:[".font-user-message","div[data-test-id='user-message']"],excludeSelectors:[]},"deepseek.com":{promptSelectors:[".ds-user-message",".message-user"],excludeSelectors:[]}}}}}const re=new ae;class f{async scrape(){return this.scrapePrompts()}async scrapePromptsWithConfig(){try{const t=window.location.hostname,e=await re.getSelectors(t);return!e||!e.promptSelectors?[]:(console.log(`[BaseAdapter] Using remote config for ${t}`),this.executeStrategy(e))}catch(t){return console.warn("[BaseAdapter] Remote scrape error:",t),[]}}executeStrategy(t){var s;const e=[],o=new Set;if(t.promptSelectors)for(const c of t.promptSelectors){const i=this.deepQuerySelectorAll(c);for(const a of i){if((s=t.excludeSelectors)!=null&&s.some(u=>a.matches(u)))continue;const r=this.cleanText(this.getVisibleText(a)),l=t.minContentLength||3;r&&r.length>=l&&!o.has(r)&&!this.isUIElement(r)&&(o.add(r),e.push({content:r,index:e.length}))}}return e}deepQuerySelectorAll(t,e=document){let o=[];try{o=Array.from(e.querySelectorAll(t))}catch{console.warn("[1prompt] Invalid selector:",t)}const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let c;for(;c=s.nextNode();){const i=c;i.shadowRoot&&(o=[...o,...this.deepQuerySelectorAll(t,i.shadowRoot)])}return o}cleanText(t){return t.replace(/\s+/g," ").trim()}isUIElement(t){return/^(copy|regenerate|share|edit|delete|save|retry|cancel|submit|send|stop|continue|new chat|clear)$/i.test(t.trim())||t.trim().length<3}getVisibleText(t){const e=t;return e.innerText||e.textContent||""}getScrollContainer(){const t=["main",'[class*="scroll-area"]','[class*="messages-container"]','[class*="chat-scroll"]','div[style*="overflow-y: auto"]','div[style*="overflow-y: scroll"]'];for(const c of t){const i=document.querySelector(c);if(i&&i.scrollHeight>i.clientHeight)return i}const e=Array.from(document.querySelectorAll("div"));let o=null,s=0;for(const c of e){const i=c.scrollHeight;i>s&&window.getComputedStyle(c).overflowY!=="hidden"&&(s=i,o=c)}return o||document.documentElement}}class ie extends f{constructor(){super(...arguments);h(this,"name","ChatGPT")}detect(){return location.hostname.includes("chatgpt.com")||location.hostname.includes("chat.openai.com")}scrapePrompts(){const e=[],o=new Set,s=this.deepQuerySelectorAll('[data-message-author-role="user"]');return console.log(`[1prompt] ChatGPT user messages found: ${s.length}`),s.forEach((c,i)=>{let a=this.cleanText(this.getVisibleText(c));if(a=a.replace(/^(you said|you)\s*:?\s*/i,"").trim(),a.length>3e3){console.log("[1prompt] Skipping very long content");return}a&&!this.isUIElement(a)&&!o.has(a)&&(o.add(a),e.push({content:a,index:i}))}),console.log(`[1prompt] ChatGPT user prompts extracted: ${e.length}`),e}}class le extends f{constructor(){super(...arguments);h(this,"name","Claude")}detect(){return location.hostname.includes("claude.ai")}scrapePrompts(){const e=[],o=new Set,s=this.deepQuerySelectorAll(['[data-testid="human-message"]',".human-message",'[class*="human"]','[class*="message"]:not([class*="assistant"]):not([class*="ai"]):not([class*="claude"])'].join(", "));return s.filter(i=>!s.some(a=>a!==i&&a.contains(i))).forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&!this.isUIElement(r)&&!o.has(r)&&(o.add(r),e.push({content:r,index:a}))}),e}}class ce extends f{constructor(){super(...arguments);h(this,"name","Gemini")}detect(){return location.hostname.includes("gemini.google.com")}scrapePrompts(){const e=[],o=new Set,s=this.deepQuerySelectorAll(["user-query",'[class*="user-query"]','[class*="query-text"]',".query-content",".user-message","[data-query]",'div[data-message-author-role="user"]'].join(", "));if(console.log(`[1prompt] Gemini candidates found: ${s.length}`),s.filter(i=>!s.some(a=>a!==i&&a.contains(i))).forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&!this.isUIElement(r)&&!o.has(r)&&(o.add(r),e.push({content:r,index:a}))}),e.length===0){const i=document.querySelector('main, [role="main"]');if(i){const a=i.querySelectorAll('[class*="turn"], [class*="message"]');let r=0;a.forEach(l=>{const u=l.className.toLowerCase();if(u.includes("model")||u.includes("response")||u.includes("answer"))return;const d=this.cleanText(this.getVisibleText(l));d&&d.length>5&&!o.has(d)&&(o.add(d),e.push({content:d,index:r++}))})}}return e}}class ue extends f{constructor(){super(...arguments);h(this,"name","Perplexity")}detect(){return location.hostname.includes("perplexity.ai")}scrapePrompts(){const e=[],o=new Set;if(document.querySelectorAll('[class*="query"], [class*="question"], [class*="user"]').forEach((c,i)=>{const a=c.className.toLowerCase();if(a.includes("answer")||a.includes("response")||a.includes("source"))return;const r=this.cleanText(this.getVisibleText(c));r&&r.length>5&&!this.isUIElement(r)&&!o.has(r)&&(o.add(r),e.push({content:r,index:i}))}),e.length===0){const c=document.querySelectorAll('[class*="thread"] > div, [class*="Thread"] > div');let i=0;c.forEach((a,r)=>{if(r%2===0){const l=this.cleanText(this.getVisibleText(a));l&&l.length>5&&!o.has(l)&&(o.add(l),e.push({content:l,index:i++}))}})}return e.length===0&&document.querySelectorAll('h1, h2, [class*="title"]').forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&r.length>10&&r.length<500&&!o.has(r)&&(o.add(r),e.push({content:r,index:a}))}),e}}class pe extends f{constructor(){super(...arguments);h(this,"name","DeepSeek")}detect(){return location.hostname.includes("deepseek.com")}scrapePrompts(){const e=[],o=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-role="user"]').forEach((a,r)=>{const l=this.cleanText(this.getVisibleText(a));l&&!this.isUIElement(l)&&!o.has(l)&&(o.add(l),e.push({content:l,index:r}))}),e.length>0)return e;const c=document.querySelectorAll('[class*="bubble"], [class*="message"]');let i=0;return c.forEach(a=>{const r=a.className.toLowerCase();if(!(r.includes("assistant")||r.includes("bot")||r.includes("ai"))&&(r.includes("user")||r.includes("human"))){const l=this.cleanText(this.getVisibleText(a));l&&l.length>3&&!o.has(l)&&(o.add(l),e.push({content:l,index:i++}))}}),e.length===0&&document.querySelectorAll("main div").forEach((r,l)=>{if(!r.querySelector(".ds-markdown")&&!r.closest(".ds-markdown")){const u=this.cleanText(this.getVisibleText(r));u&&u.length>10&&u.length<2e3&&!o.has(u)&&!u.includes("```")&&!u.startsWith("#")&&(o.add(u),e.push({content:u,index:l}))}}),e}}class de extends f{constructor(){super(...arguments);h(this,"name","Lovable")}detect(){return location.hostname.includes("lovable.dev")}cleanContent(e){const o=e.cloneNode(!0),s=["button","svg","path",'[role="button"]','[aria-hidden="true"]',".lucide",'[class*="chevron"]','[class*="tooltip"]','[class*="badge"]',"nav","header","footer","aside"];return o.querySelectorAll(s.join(", ")).forEach(c=>c.remove()),this.cleanText(this.getVisibleText(o))}isUserPrompt(e){const o=e.className;if(o.includes("whitespace-normal"))return!0;if(o.includes("prose-h1:mb-2"))return!1;let s=e.parentElement,c=0;for(;s&&c<5;){const i=s.className;if(i.includes("justify-end")||i.includes("ml-auto"))return!0;if(i.includes("assistant")||i.includes("bot"))return!1;s=s.parentElement,c++}return!1}scrapePrompts(){console.log("[SahAI] Lovable Extraction Engine starting (v1.1.0 - ba96d2c multi-position)...");const e=[],o=new Set,s=this.deepQuerySelectorAll('[class*="prose"]');return console.log(`[SahAI] Found ${s.length} total prose elements`),s.forEach(c=>{var l;const i=c;if(!this.isUserPrompt(i))return;const a=((l=i.textContent)==null?void 0:l.trim())||"";if(a.length<2||a.length>5e3||o.has(a))return;const r=this.cleanContent(i);r&&r.length>2&&!o.has(r)&&(o.add(r),e.push({content:r,index:e.length}))}),console.log(`[SahAI] Total user prompts extracted: ${e.length}`),e}getScrollContainer(){let e=document.querySelector("main");if(e&&e.scrollHeight>e.clientHeight)return e;const o=[".flex.flex-col.overflow-y-auto",'[class*="overflow-y-auto"]','[class*="chat-container"]','[class*="messages-container"]',".flex-1.overflow-y-auto",'[role="region"]'];for(const s of o){const c=document.querySelector(s);if(c&&c.scrollHeight>c.clientHeight*1.2)return c}return null}}class me extends f{constructor(){super(...arguments);h(this,"name","Bolt")}detect(){return location.hostname.includes("bolt.new")}scrapePrompts(){const e=[],o=new Set;if(document.querySelectorAll('[class*="user"], [class*="prompt"], [class*="input-message"]').forEach((a,r)=>{const l=a.className.toLowerCase();if(l.includes("assistant")||l.includes("response")||l.includes("output"))return;const u=this.cleanText(this.getVisibleText(a));u&&!this.isUIElement(u)&&!o.has(u)&&(o.add(u),e.push({content:u,index:r}))}),e.length>0)return e;const c=document.querySelectorAll('[class*="message"], [class*="Message"]');let i=0;return c.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("user")||r.includes("human")||r.includes("you")){const l=this.cleanText(this.getVisibleText(a));l&&l.length>3&&!o.has(l)&&(o.add(l),e.push({content:l,index:i++}))}}),e.length===0&&document.querySelectorAll('[class*="workspace"] [class*="prompt"], [class*="project"] [class*="request"]').forEach((r,l)=>{const u=this.cleanText(this.getVisibleText(r));u&&u.length>5&&!o.has(u)&&(o.add(u),e.push({content:u,index:l}))}),e}}class he extends f{constructor(){super(...arguments);h(this,"name","Cursor")}detect(){return location.hostname.includes("cursor.sh")||location.hostname.includes("cursor.com")}scrapePrompts(){const e=[],o=new Set;if(document.querySelectorAll('[class*="user-message"], [class*="UserMessage"], [data-role="user"]').forEach((a,r)=>{const l=this.cleanText(this.getVisibleText(a));l&&!this.isUIElement(l)&&!o.has(l)&&(o.add(l),e.push({content:l,index:r}))}),e.length>0)return e;const c=document.querySelectorAll('[class*="chat"] [class*="message"], [class*="conversation"] [class*="turn"]');let i=0;return c.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("assistant")||r.includes("bot")||r.includes("ai")||r.includes("response"))return;const l=this.cleanText(this.getVisibleText(a));l&&l.length>3&&!o.has(l)&&(o.add(l),e.push({content:l,index:i++}))}),e.length===0&&document.querySelectorAll('[class*="command"], [class*="prompt-history"], [class*="input-history"]').forEach((r,l)=>{const u=this.cleanText(this.getVisibleText(r));u&&u.length>5&&!o.has(u)&&(o.add(u),e.push({content:u,index:l}))}),e}}class ge extends f{constructor(){super(...arguments);h(this,"name","Meta AI")}detect(){return location.hostname.includes("meta.ai")}scrapePrompts(){const e=[],o=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-type="user"]').forEach((a,r)=>{const l=a.className.toLowerCase();if(l.includes("assistant")||l.includes("response")||l.includes("meta"))return;const u=this.cleanText(this.getVisibleText(a));u&&!this.isUIElement(u)&&!o.has(u)&&(o.add(u),e.push({content:u,index:r}))}),e.length>0)return e;const c=document.querySelectorAll('[class*="bubble"], [class*="Bubble"]');let i=0;if(c.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("right")||r.includes("user")||r.includes("outgoing")){const l=this.cleanText(this.getVisibleText(a));l&&l.length>3&&!o.has(l)&&(o.add(l),e.push({content:l,index:i++}))}}),e.length===0){const a=document.querySelector('[class*="thread"], [class*="conversation"], [role="log"]');a&&a.querySelectorAll(":scope > div, :scope > li").forEach((l,u)=>{if(l.querySelector('.markdown, pre, code, [class*="response"]'))return;const d=this.cleanText(this.getVisibleText(l));d&&d.length>5&&d.length<2e3&&!o.has(d)&&(o.add(d),e.push({content:d,index:u}))})}return e}}class fe extends f{constructor(){super(...arguments);h(this,"name","generic")}detect(){return!0}scrapePrompts(){const e=window.location.href;let o=[];if(e.includes("gemini.google.com")){const c=(a,r=document)=>{let l=[];r.querySelectorAll(a).forEach(w=>l.push(w));const u=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,null);let d;for(;d=u.nextNode();)d.shadowRoot&&(l=l.concat(c(a,d.shadowRoot)));return l},i=c("user-query");if(i.length>0)return i.map((a,r)=>{var u;const l=(u=a.innerText)==null?void 0:u.trim();return l&&l.length>0?{content:l,index:r}:null}).filter(a=>a!==null)}const s=this.findChatContainer();return s&&(o=this.extractMessages(s)),o.length>1e3&&(console.warn("[1prompt] Truncating extraction at 1000 prompts safety limit"),o=o.slice(0,1e3)),o.map((c,i)=>({content:c.content,index:i}))}findChatContainer(){const e=["infinite-scroller",'[role="log"]','[role="main"]',".chat-history",".conversation","main"];for(const o of e){const s=document.querySelector(o);if(s&&s.innerText.length>200)return s}return document.body}extractMessages(e){var i;const o=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let c;for(;c=s.nextNode();){const a=((i=c.textContent)==null?void 0:i.trim())||"",r=c.parentElement;if(a.length<2||this.isSystemNoise(a)||(r==null?void 0:r.tagName.toLowerCase())==="model-response"||r!=null&&r.classList.contains("model-response-text")||(r==null?void 0:r.getAttribute("data-message-author-role"))==="assistant")continue;const l=a.toLowerCase();if(![/should be written (about|on|for)/i,/the story should/i,/story for class \d+/i,/resulting in a positive resolution/i,/clear moral about/i,/focus on (friendship|teamwork|cooperation)/i,/\bmet near\b/i,/help solve through/i,/spend time together/i].some(u=>u.test(a))&&![/^(one|a) (bright|sunny|dark|cold|warm|beautiful|clear) (day|morning|evening|night)/i,/once upon a time/i,/the end/i,/chapter \d+/i,/lived (his|her|their) life/i,/was a (golden retriever|cow|dog|cat|yellow frog|rabbit)/i,/near a (clear|beautiful|sparkling|calm) (pond|river|lake|stream)/i,/who met near/i,/faces a small problem/i].some(u=>u.test(a))&&!(l.startsWith("here is")||l.startsWith("sure, i can")||l.startsWith("i have")||l.startsWith("certainly")||l.startsWith("of course")||l.startsWith("here's a"))){if(a.length>200){const u=["create","write","make","fix","generate","build","explain","how","what","why","list","show","tell","give","help","find","debug"],d=a.split(" ")[0].toLowerCase();if(!u.includes(d))continue}l.includes("the cow, dog, and")||l.includes("yellow frog")||l.includes("calm problem-solving")||l.includes("sahai turns")||l.includes("scattered ai conversations")||l.includes("actionable workflow")||l.includes("work with ai with an edge")||l.includes("generates summaries of all prompts")||l.includes("no duplicates")||l.includes("cancel out the conflict")||/^(\d+\.|-|\*|â€¢)?\s*(the image shows|image of|this image depicts)/i.test(a)||o.push({role:"user",content:a})}}return this.mergeFragments(o)}isSystemNoise(e){return["Regenerate","Modify","Share","Google","Copy","Bad response","Good response"].includes(e)}mergeFragments(e){if(e.length===0)return[];const o=[];let s={...e[0]};for(let c=1;c<e.length;c++){const i=e[c];i.role===s.role?s.content+=`
`+i.content:(o.push(s),s={...i})}return o.push(s),o}}const be=[new ie,new le,new ce,new ue,new pe,new de,new me,new he,new ge,new fe];function P(){return be.find(n=>n.detect())||null}function U(){const n=P();return n?n.name:null}const L={version:1,platforms:{chatgpt:{userSelectors:['[data-message-author-role="user"]',".user-message"],buttonSelectors:['button[data-testid="send-button"]'],inputSelectors:["#prompt-textarea"]},claude:{userSelectors:[".font-user-message",'[data-test-id="user-message"]'],buttonSelectors:['button[aria-label="Send Message"]'],inputSelectors:['div[contenteditable="true"]']}},aiConfig:{defaultProvider:"auto"}},z="remote_selector_config",ye="remote_config_last_fetch",x=class x{constructor(){h(this,"config",L)}static getInstance(){return x.instance||(x.instance=new x),x.instance}async initialize(){const t=await chrome.storage.local.get([z,ye]);t[z]&&(this.config={...L,...t[z]})}getSelectors(t){return this.config.platforms[t]||null}getAIConfig(){return this.config.aiConfig||L.aiConfig}};h(x,"instance");let B=x;const Se={lovable:{name:"Lovable",topAttempts:70,bottomAttempts:70,waitPerScroll:600,stabilityChecks:6,parallelWait:1200},chatgpt:{name:"ChatGPT",topAttempts:40,bottomAttempts:40,waitPerScroll:400,stabilityChecks:4,parallelWait:800},claude:{name:"Claude",topAttempts:40,bottomAttempts:40,waitPerScroll:400,stabilityChecks:4,parallelWait:800},gemini:{name:"Gemini",topAttempts:35,bottomAttempts:35,waitPerScroll:350,stabilityChecks:4,parallelWait:750},perplexity:{name:"Perplexity",topAttempts:35,bottomAttempts:35,waitPerScroll:350,stabilityChecks:4,parallelWait:750},deepseek:{name:"DeepSeek",topAttempts:30,bottomAttempts:30,waitPerScroll:300,stabilityChecks:3,parallelWait:600},bolt:{name:"Bolt.new",topAttempts:30,bottomAttempts:30,waitPerScroll:300,stabilityChecks:3,parallelWait:600},cursor:{name:"Cursor",topAttempts:30,bottomAttempts:30,waitPerScroll:300,stabilityChecks:3,parallelWait:600},"meta-ai":{name:"Meta AI",topAttempts:25,bottomAttempts:25,waitPerScroll:250,stabilityChecks:3,parallelWait:500}},xe={lovable:{name:"Lovable",topAttempts:50,bottomAttempts:50,waitPerScroll:200,stabilityChecks:2,parallelWait:300},chatgpt:{name:"ChatGPT",topAttempts:30,bottomAttempts:30,waitPerScroll:150,stabilityChecks:2,parallelWait:250},claude:{name:"Claude",topAttempts:30,bottomAttempts:30,waitPerScroll:150,stabilityChecks:2,parallelWait:250},gemini:{name:"Gemini",topAttempts:25,bottomAttempts:25,waitPerScroll:120,stabilityChecks:2,parallelWait:200},perplexity:{name:"Perplexity",topAttempts:25,bottomAttempts:25,waitPerScroll:120,stabilityChecks:2,parallelWait:200},deepseek:{name:"DeepSeek",topAttempts:20,bottomAttempts:20,waitPerScroll:100,stabilityChecks:2,parallelWait:150},bolt:{name:"Bolt.new",topAttempts:20,bottomAttempts:20,waitPerScroll:100,stabilityChecks:2,parallelWait:150},cursor:{name:"Cursor",topAttempts:20,bottomAttempts:20,waitPerScroll:100,stabilityChecks:2,parallelWait:150},"meta-ai":{name:"Meta AI",topAttempts:15,bottomAttempts:15,waitPerScroll:80,stabilityChecks:2,parallelWait:150}},we={lovable:"slow",chatgpt:"fast",claude:"fast",gemini:"fast",perplexity:"fast",deepseek:"fast",bolt:"fast",cursor:"fast","meta-ai":"fast"};function M(n){const t=n||"generic",e=t.toLowerCase().replace(/\s+/g,"-"),o=we[e]||"fast",s=o==="slow"?Se:xe,c=s[e]||s[n||""];return c?(console.log(`[1prompt] Platform: ${c.name} (${o.toUpperCase()} mode)`),c):(console.log(`[1prompt] Platform: ${t} (FAST mode - default)`),{name:t,topAttempts:15,bottomAttempts:15,waitPerScroll:100,stabilityChecks:2,parallelWait:150})}function Ae(n){const t=M(n);return t.topAttempts>=40?"TIER 1 (Slow/Thorough)":t.topAttempts>=25?"TIER 2 (Moderate)":"TIER 3 (Fast)"}window.location.hostname.includes("1-prompt.in")&&(document.documentElement.setAttribute("data-1prompt-installed","true"),console.log("[1prompt] Extension detected on 1-prompt.in"));let R=!1,m=P(),p=U();function ve(){m=P(),p=U(),D()}function D(){chrome.runtime.sendMessage({action:"STATUS_RESULT",supported:!!m,platform:p,hasPrompts:m?m.scrapePrompts().length>0:!1})}B.getInstance().initialize();let g=[];m||console.warn("[SahAI] No adapter found for this page. Buttons will not be shown.");let O=null;const Ee={chatgpt:['button[data-testid="send-button"]','button[data-testid="composer-send-button"]','form button[type="submit"]','button[aria-label*="Send"]'],claude:['button[aria-label="Send Message"]','button[type="submit"]',"fieldset button:last-child"],gemini:['button[aria-label*="Send"]',".send-button",'button[data-test-id="send-button"]'],perplexity:['button[aria-label="Submit"]','button[type="submit"]'],deepseek:['button[data-testid="send-button"]',".send-btn"],lovable:['button[type="submit"]','button[aria-label*="Send"]'],bolt:['button[type="submit"]',".send-button"],cursor:['button[type="submit"]'],"meta-ai":['button[aria-label*="Send"]','button[type="submit"]']},H={chatgpt:["#prompt-textarea",'textarea[data-id="root"]','div[contenteditable="true"][data-placeholder]'],claude:['div[contenteditable="true"]',"fieldset div[contenteditable]"],gemini:[".ql-editor","rich-textarea div[contenteditable]","textarea"],perplexity:["textarea",'div[contenteditable="true"]'],deepseek:["textarea","#chat-input textarea"],lovable:["textarea"],bolt:["textarea"],cursor:["textarea"],"meta-ai":['div[contenteditable="true"]',"textarea"]};function Te(){const n=H[p||""]||["textarea",'[contenteditable="true"]'];for(const o of n){const s=document.querySelector(o);if(s&&s.offsetParent!==null)return s}const t=document.querySelector("textarea");if(t&&t.offsetParent!==null)return t;const e=document.querySelector('[contenteditable="true"]');return e&&e.offsetParent!==null?e:null}function F(n){var t,e;return n?n instanceof HTMLTextAreaElement?n.value.trim():n.getAttribute("contenteditable")==="true"&&(((t=n.innerText)==null?void 0:t.trim())||((e=n.textContent)==null?void 0:e.trim()))||"":""}function W(){const n=H[p||""]||[];for(const o of n){const s=document.querySelector(o);if(s&&s.offsetParent!==null)return s}const t=document.querySelector('textarea:not([type="hidden"])');if(t&&t.offsetParent!==null)return t;const e=document.querySelector('[contenteditable="true"]');return e&&e.offsetParent!==null?e:null}function G(){const n=W(),t=F(n);return t&&t.length>0?(console.log("[SahAI] Captured prompt:",t.slice(0,50)+"..."),t):null}function v(){const n=window.location.href,e={chatgpt:/\/c\/([a-zA-Z0-9-]+)/,claude:/\/chat\/([a-zA-Z0-9-]+)/,gemini:/\/app\/([a-zA-Z0-9-]+)/,perplexity:/\/search\/([a-zA-Z0-9-]+)/,deepseek:/\/chat\/([a-zA-Z0-9-]+)/,lovable:/\/projects\/([a-zA-Z0-9-]+)/,bolt:/\/~\/([a-zA-Z0-9-]+)/,cursor:/\/chat\/([a-zA-Z0-9-]+)/,"meta-ai":/\/c\/([a-zA-Z0-9-]+)/}[p||""];if(e){const s=n.match(e);if(s)return s[1]}const o=new URL(n).pathname;return`fallback_${Ce(o)}`}function Ce(n){let t=0;for(let e=0;e<n.length;e++){const o=n.charCodeAt(e);t=(t<<5)-t+o,t=t&t}return Math.abs(t).toString(36)}function V(){const n=v();return`sessionPrompts_${p}_${n}`}function ke(n){return[/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/,/\b(?:\d{4}[-\s]?){3}\d{4}\b/,/\b\d{3}-\d{2}-\d{4}\b/,/\b(?:\+?1[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b/,/\b(sk|pk|api)[-_]?[a-zA-Z0-9]{20,}\b/i,/AKIA[0-9A-Z]{16}/,/password\s*[:=]\s*\S+/i,/eyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*/].some(e=>e.test(n))}function Z(n){var r;if(!n||n.trim().length===0)return;const t=v(),e=n.trim(),o=e.toLowerCase();if(ke(e)){console.log("[SahAI] Skipping prompt with sensitive data (PII detected)");return}if(o.includes("branding approach:")||o.includes("selected option:")||o.includes("choice:")){console.log("[SahAI] Skipping system choice capture");return}if(g.some(l=>S(l.content)===S(e))){console.log("[SahAI] Skipping duplicate prompt");return}const c={content:e,index:g.length,timestamp:Date.now(),conversationId:t,source:"keylog"};g.push(c);const i=V();(r=chrome.storage.session)==null||r.set({[i]:g}).catch(()=>{chrome.storage.local.set({[i]:g})}),console.log(`[SahAI] Session prompts for ${t}: ${g.length}`);const a=(l=2)=>{chrome.runtime.sendMessage({action:"SAVE_SESSION_PROMPTS",prompts:[c],platform:p||"unknown",conversationId:t},u=>{chrome.runtime.lastError?(console.warn("[SahAI] Failed to save prompt:",chrome.runtime.lastError.message),l>0?setTimeout(()=>a(l-1),500):console.error("[SahAI] Could not save prompt after retries. Data saved locally only.")):u!=null&&u.success&&console.log("[SahAI] Prompt saved to background")})};a()}async function _(){var n;try{const t=V(),e=await((n=chrome.storage.session)==null?void 0:n.get(t))||await chrome.storage.local.get(t);e[t]&&(g=e[t],console.log(`[SahAI] Loaded ${g.length} session prompts for conversation`))}catch{console.log("[SahAI] Could not load session prompts")}}function E(){const n=Ee[p||""]||[];for(const t of n)document.querySelectorAll(t).forEach(o=>{o.getAttribute("data-pe-hooked")||(o.setAttribute("data-pe-hooked","true"),o.addEventListener("mousedown",()=>{const s=G();s&&(o.__peText=s)},!0),o.addEventListener("click",()=>{const s=o.__peText;s&&(Z(s),o.__peText=null)},!0),console.log("[SahAI] Hooked send button:",t))})}function T(){const n=W();if(!n||n.getAttribute("data-pe-key-hooked"))return;n.setAttribute("data-pe-key-hooked","true");let t=null;n.addEventListener("keydown",o=>{const s=o.key==="Enter",c=o.key==="Enter"&&(o.ctrlKey||o.metaKey),i=o.key==="Enter"&&o.shiftKey;if(s&&!i||c){const a=G();a&&a.length>0&&(t={text:a,timestamp:Date.now()})}},!0);const e=new MutationObserver(()=>{if(!t)return;if(Date.now()-t.timestamp>2e3){t=null;return}const o=F(n);(!o||o.length<10)&&(Z(t.text),t=null)});e.observe(n,{childList:!0,subtree:!0,characterData:!0,attributes:!0,attributeFilter:["value"]}),n.parentElement&&e.observe(n.parentElement,{childList:!0}),console.log("[SahAI] Hooked keyboard submit with MutationObserver")}function Ie(){if(!m||!p)return;_(),E(),T();let n=null;new MutationObserver(()=>{n&&clearTimeout(n),n=setTimeout(()=>{E(),T()},500)}).observe(document.body,{childList:!0,subtree:!0});let e=location.href;new MutationObserver(()=>{location.href!==e&&(e=location.href,console.log("[SahAI] URL changed, reloading session"),g=[],_(),setTimeout(()=>{E(),T()},1e3))}).observe(document.body,{childList:!0,subtree:!0}),console.log("[SahAI] Real-time capture initialized (optimized)")}async function Pe(){if(!m)return;const n=m.getScrollContainer();if(!n){console.warn("[SahAI] No scroll container found, skipping history load");return}const t=M(p),e=Ae(p);console.log(`[SahAI] Starting conversation scroll on container: ${n.tagName}`),console.log(`[SahAI] Platform: ${p} (${e})`),console.log(`[SahAI] Config: top=${t.topAttempts}, bottom=${t.bottomAttempts}, wait=${t.waitPerScroll}ms, stability=${t.stabilityChecks}`);let o=0;chrome.runtime.sendMessage({action:"PROGRESS",message:"1prompt is scrolling to capture your lengthy conversation"}),chrome.runtime.sendMessage({action:"PROGRESS",message:"Discovering all messages..."}),console.log(`[SahAI] Phase 1: Scrolling to bottom (${t.bottomAttempts} attempts)...`);for(let i=0;i<t.bottomAttempts;i++){n.scrollTop=n.scrollHeight,n.scrollTo({top:n.scrollHeight,behavior:"auto"}),await new Promise(r=>setTimeout(r,t.waitPerScroll));const a=n.scrollHeight;if(console.log(`[SahAI] Bottom scroll ${i+1}/${t.bottomAttempts}: height ${a}px (max: ${o}px)`),a===o){console.log("[SahAI] Height stable - all content discovered");break}o=a}console.log(`[SahAI] Phase 2: Scrolling to top (${t.topAttempts} attempts)...`),chrome.runtime.sendMessage({action:"PROGRESS",message:"Navigating to oldest messages..."});let s=0,c=0;for(let i=0;i<t.topAttempts;i++){n.scrollTop=0,n.scrollTo({top:0,behavior:"auto"}),await new Promise(r=>setTimeout(r,t.waitPerScroll));const a=n.scrollHeight;if(console.log(`[SahAI] Top scroll ${i+1}/${t.topAttempts}: height ${a}px (max: ${s}px)`),a===s){if(c++,c>=t.stabilityChecks){console.log(`[SahAI] Top height stable for ${t.stabilityChecks} checks - all oldest messages loaded`);break}}else c=0;s=a}console.log(`[SahAI] Scroll complete. Total height: ${n.scrollHeight}px. Ready for extraction.`)}async function Le(n){const t=[],e=new Set;let o=0;const s=n.getScrollContainer();if(!s)return console.warn("[SahAI] No scroll container for parallel extraction"),n.scrapePrompts();const c=M(p),i=s.scrollHeight;console.log(`[SahAI] Starting parallel extraction from height: ${i}px`),console.log(`[SahAI] Using platform wait time: ${c.parallelWait}ms`);const a=[{name:"TOP",position:0},{name:"25%",position:i*.25},{name:"MIDDLE",position:i*.5},{name:"75%",position:i*.75},{name:"BOTTOM",position:i}];console.log(`[SahAI] Extracting from ${a.length} positions...`);for(const r of a){console.log(`[SahAI] [${r.name}] Scrolling to ${Math.round(r.position)}px...`),s.scrollTop=r.position,s.scrollTo({top:r.position,behavior:"auto"}),await new Promise(u=>setTimeout(u,c.parallelWait));const l=await n.scrape();console.log(`[SahAI] [${r.name}] Found ${l.length} prompts`);for(const u of l)e.has(u.content)?console.log(`[SahAI] [${r.name}] Duplicate: ${u.content.slice(0,40)}...`):(e.add(u.content),u.index=o++,u.source="dom",t.push(u),console.log(`[SahAI] [${r.name}] Added: ${u.content.slice(0,40)}...`))}return console.log(`[SahAI] Parallel extraction complete: ${t.length} unique prompts`),t}async function j(n="auto"){(n==="auto"||n==="dom")&&m&&await Pe();let t=[];if(n==="auto"||n==="keylog"){const i=[...g],a=v();let r=[];if(a)try{console.log("[SahAI] Fetching persistent logs for:",a);const u=chrome.runtime.sendMessage({action:"GET_CONVERSATION_LOGS",platform:p,conversationId:a}),d=new Promise(oe=>setTimeout(()=>oe({prompts:[]}),1500)),w=await Promise.race([u,d]);w&&w.prompts&&(r=w.prompts,console.log(`[SahAI] Found ${r.length} persistent prompts`))}catch(u){console.error("[SahAI] Failed to fetch persistent logs:",u)}t=[...r];const l=new Set(r.map(u=>S(u.content)));for(const u of i)l.has(S(u.content))||t.push(u)}if(n==="keylog")return t.map((i,a)=>({...i,index:a})).sort((i,a)=>(i.timestamp||0)-(a.timestamp||0));let e=[];if((n==="auto"||n==="dom")&&m&&(console.log("[SahAI] Augmenting with DOM scraping..."),(p==null?void 0:p.toLowerCase())==="lovable"?(console.log("[SahAI] Using ba96d2c slow multi-position extraction for Lovable..."),e=await Le(m)):(console.log(`[SahAI] Using fast DOM extraction for ${p}...`),e=await m.scrape()),console.log(`[SahAI] DOM extraction complete: ${e.length} prompts`)),n==="dom")return e;if(e.length===0&&t.length>0)return console.log("[SahAI] Using captured prompts as primary source"),t.map((i,a)=>({...i,index:a})).sort((i,a)=>(i.timestamp||0)-(a.timestamp||0));const o=new Map;for(const i of t)o.set(S(i.content),i);let s=[];const c=new Set;for(let i=0;i<e.length;i++){const a=e[i],r=S(a.content);if(c.has(r))continue;const l=o.get(r);l?s.push({...l,index:s.length,source:l.source||"keylog"}):s.push({...a,index:s.length,source:"dom"}),c.add(r)}for(const i of t){const a=S(i.content);c.has(a)||(console.log(`[SahAI] Adding captured prompt not found in DOM: ${i.content.slice(0,40)}...`),s.push({...i,index:s.length,source:i.source||"keylog"}),c.add(a))}return console.log(`[SahAI] Extraction complete: ${s.length} prompts (${e.length} from DOM, ${t.length} captured)`),s}function S(n){return n.toLowerCase().trim().replace(/\s+/g," ").slice(0,200)}function K(n){const t=v();return{platform:p||"unknown",url:window.location.href,title:document.title,prompts:n,extractedAt:Date.now(),conversationId:t}}const ze=`

  .pe-has-zone1-absolute {
    position: relative !important;
    padding-top: 48px !important;
    overflow: visible !important;
  }

  .pe-zone1 {
    position: absolute !important;
    top: 8px !important;
    left: 8px !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    width: calc(100% - 16px) !important;
    box-sizing: border-box !important;
    background: transparent !important;
    padding-bottom: 0 !important;
    border-bottom: none !important;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif !important;
    z-index: 2147483647 !important;
    pointer-events: auto !important;
    visibility: visible !important;
    opacity: 1 !important;
    height: 32px !important;
  }
  
  .pe-zone1-btn {
    position: relative !important;
    z-index: 10001 !important;
    box-sizing: border-box !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    height: 32px !important;
    min-height: 32px !important;
    padding: 0 16px !important;
    border-radius: 16px !important;
    font-size: 13px !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif !important;
    font-weight: 700 !important;
    line-height: 1 !important;
    margin: 0 !important;
    text-transform: none !important;
    letter-spacing: -0.01em !important;
    cursor: pointer !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
    white-space: nowrap !important;
    pointer-events: auto !important;
    outline: none !important;
    overflow: hidden !important;
    
    /* Glass & Line-Art Style */
    background: rgba(255, 255, 255, 0.75) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 0.8px solid rgba(0, 90, 226, 0.2) !important;
    color: #002D8B !important; /* Midnight Blue */
    box-shadow: 0 2px 8px rgba(0, 45, 139, 0.05) !important;
  }

  .pe-zone1-btn::before {
    content: "" !important;
    position: absolute !important;
    width: 60px !important;
    height: 60px !important;
    background: radial-gradient(circle, rgba(0, 90, 226, 0.15) 0%, transparent 70%) !important;
    border-radius: 50% !important;
    filter: blur(10px) !important;
    opacity: 0 !important;
    pointer-events: none !important;
    z-index: -1 !important;
    top: -50% !important;
    left: -50% !important;
    animation: pe-wander 12s infinite ease-in-out !important;
  }
  
  .pe-zone1-btn:hover::before {
    opacity: 1 !important;
  }

  @keyframes pe-wander {
    0% { transform: translate(-20%, -20%) scale(1); opacity: 0; }
    20% { transform: translate(40%, 10%) scale(1.2); opacity: 0.6; }
    40% { transform: translate(10%, 60%) scale(0.8); opacity: 0.3; }
    60% { transform: translate(70%, 30%) scale(1.1); opacity: 0.5; }
    80% { transform: translate(30%, 80%) scale(0.9); opacity: 0.4; }
    100% { transform: translate(-20%, -20%) scale(1); opacity: 0; }
  }
  
  .pe-zone1-btn:hover {
    background: rgba(255, 255, 255, 0.95) !important;
    border-color: #005AE2 !important; /* Vibrant Blue */
    color: #005AE2 !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 6px 16px rgba(0, 45, 139, 0.12) !important;
  }

  .pe-zone1-btn:active {
    transform: scale(0.96) !important;
  }

  .pe-zone1-btn.loading {
    pointer-events: none !important;
    opacity: 0.7 !important;
  }
  
  .pe-zone1-btn.extract, .pe-zone1-btn.summarize, .pe-zone1-btn.paste {
    /* Base styles handled by pe-zone1-btn */
  }
  
  .pe-zone1-btn svg {
    width: 12px !important;
    height: 12px !important;
    margin-right: 6px !important;
    display: inline-block !important;
    vertical-align: middle !important;
    flex-shrink: 0 !important;
    stroke-width: 2.5 !important;
  }

  @keyframes pe-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .pe-spinner {
    animation: pe-spin 1s linear infinite !important;
    transform-origin: center !important;
    color: #005AE2 !important; /* Logo Vibrant Blue */
  }
`,Be={chatgpt:["#composer-background",'[data-testid="composer-background"]',"#prompt-textarea-wrapper",'form[class*="stretch"] > div > div','form.w-full > div > div[class*="relative"]',"main form > div > div"],claude:['div:has(> [contenteditable="true"])','div.relative:has([contenteditable="true"])','fieldset:has([contenteditable="true"])','form:has([contenteditable="true"])','[data-testid="composer-container"]',".composer-container"],gemini:["rich-textarea",".input-area",".input-area-container",'section[class*="input-area"]',".text-input-field_textarea-wrapper"],perplexity:['[data-testid="ask-input-container"]',".ask-input-container"],deepseek:[".chat-input-container","#chat-input"],lovable:[".prompt-input-container",'[data-testid="prompt-input"]','div[class*="PromptBox"]','div[class*="InputArea"]'],bolt:[".chat-input",'[data-testid="chat-input"]'],cursor:[".input-container",'[data-testid="input"]'],"meta-ai":['[data-testid="composer"]',".composer"]};function Q(){const n=Be[p||""]||[];for(const o of n){const s=document.querySelector(o);if(s&&s.offsetParent!==null){if(s.getAttribute("contenteditable")==="true"||s.tagName==="TEXTAREA")continue;const c=window.getComputedStyle(s);if(c.display==="none"||c.visibility==="hidden"||c.opacity==="0")continue;const i=s.getBoundingClientRect();if(i.height>450||i.height<20)continue;return s}}if(p==="claude"){const o=document.querySelector('[contenteditable="true"], textarea');if(o&&o.offsetParent!==null){const s=o.closest("div.relative, fieldset, form");if(s&&s.offsetParent!==null){const a=s.getBoundingClientRect();if(a.height>30&&a.height<450)return s}let c=o.parentElement,i=0;for(;c&&i<6;){const a=c.getBoundingClientRect(),r=c.getAttribute("contenteditable")==="true",l=window.getComputedStyle(c),u=l.display!=="none"&&l.visibility!=="hidden"&&l.opacity!=="0";if(a.height>30&&a.height<400&&!r&&u)return c;c=c.parentElement,i++}}}if(p==="chatgpt"){const o=document.querySelector('form[class*="stretch"], form.w-full');if(o){const s=o.querySelector('div[class*="rounded"]');if(s&&s.offsetParent!==null)return s;const c=o.querySelector(":scope > div > div");if(c)return c}}const t=document.querySelectorAll('textarea, [contenteditable="true"]');for(const o of t)if(o.offsetParent!==null){let s=o.parentElement,c=0;for(;s&&c<6;){const i=window.getComputedStyle(s),a=i.borderRadius&&i.borderRadius!=="0px",r=i.backgroundColor!=="transparent"&&i.backgroundColor!=="rgba(0, 0, 0, 0)";if((a||r)&&s.getBoundingClientRect().height<450)return s;s=s.parentElement,c++}}const e=document.querySelectorAll("form");for(const o of e)if(o.querySelector('textarea, [contenteditable="true"]')&&o.getBoundingClientRect().height<450)return o;return null}function Me(){if(document.getElementById("pe-styles"))return;const n=document.createElement("style");n.id="pe-styles",n.textContent=ze,(document.head||document.documentElement).appendChild(n)}function X(){const n=document.createElement("div");n.id="pe-zone1",n.className="pe-zone1";const t=document.createElement("button");t.id="pe-extract-btn",t.className="pe-zone1-btn extract",t.textContent="Capture",t.title="Extract raw prompts to SahAI",t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),ee("capture",t)},!0),n.appendChild(t);const e=document.createElement("button");return e.id="pe-summarize-btn",e.className="pe-zone1-btn summarize",e.textContent="Compile",e.title="Capture and compile prompts with AI",e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),ee("compile",e)},!0),n.appendChild(e),n}function Y(n){n.classList.add("loading"),n.innerHTML=`
    <svg class="pe-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
      <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
    </svg>
    Capturing...
  `}function J(n,t){n.innerHTML=`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="width:14px; height:14px; margin-right:6px; display:inline-block; vertical-align:middle;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    Done!
  `,setTimeout(()=>{n.classList.remove("loading"),n.textContent=t},2e3)}async function ee(n,t){console.log(`[SahAI] Button clicked: ${n}`);const e=n==="compile",o=e?"Compile":"Capture";chrome.runtime.sendMessage({action:"OPEN_SIDE_PANEL"}),chrome.runtime.sendMessage({action:"EXTRACT_TRIGERED_FROM_PAGE",mode:n}),Y(t),e&&(t.innerHTML=`
      <svg class="pe-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
        <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
      </svg>
      Compiling...
    `);try{console.log("[SahAI] Starting extraction...");const s=await j();console.log(`[SahAI] Extracted ${s.length} prompts`);const c=K(s);console.log("[SahAI] Sending EXTRACTION_FROM_PAGE to background..."),chrome.runtime.sendMessage({action:"EXTRACTION_FROM_PAGE",result:c,mode:n}),J(t,o)}catch(s){console.error("[SahAI] Error:",s),t.textContent="Error",setTimeout(()=>{t.classList.remove("loading"),t.textContent=o},2e3)}}function $(){if(console.log("[SahAI] Attempting to create zoned layout..."),document.getElementById("pe-zone1")||!m)return;const n=window.location.href,t=n.includes("/c/")||n.includes("/chat/")||n.includes("/thread/")||n.includes("/projects/"),e=new URL(n),o=(e.hostname.includes("chatgpt.com")||e.hostname.includes("openai.com"))&&(e.pathname==="/"||e.pathname==="");if(p==="claude"){if(window.location.hostname.includes("claude.ai")&&!window.location.pathname.includes("/chat"))return}else if(p==="chatgpt"&&!t&&!o)return;const s=Q();if(Me(),s){s.style.display="",s.style.flexDirection="",s.style.alignItems="",s.style.gap="",s.classList.add("pe-has-zone1-absolute");const c=X();if(s.prepend(c),document.getElementById("pe-zone1")){const i=document.getElementById("pe-floating-zone");i&&i.remove(),p==="claude"&&new MutationObserver(()=>{document.getElementById("pe-zone1")||(console.log("[SahAI] Claude removed buttons, re-injecting..."),s.prepend(X())),s.classList.contains("pe-has-zone1-absolute")||(console.log("[SahAI] Claude removed layout class, re-applying..."),s.classList.add("pe-has-zone1-absolute"),s.style.paddingTop="48px")}).observe(s,{childList:!0,attributes:!0,attributeFilter:["class","style"]})}console.log("[SahAI] Zoned layout initialized (Input Container Mode)")}}function Re(){const n=document.getElementById("pe-zone1");if(!n||document.getElementById("pe-paste-btn"))return;const t=document.createElement("button");t.id="pe-paste-btn",t.className="pe-zone1-btn paste",t.innerHTML=`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
       <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
       <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
    </svg>
    Paste
  `,t.title="Paste copied prompts into Chat",t.onclick=e=>{e.preventDefault(),e.stopPropagation(),_e()},n.appendChild(t)}function Oe(){const n=document.getElementById("pe-paste-btn");n&&n.remove()}async function _e(){let n=O;if(!n)try{n=await navigator.clipboard.readText()}catch(e){console.error("Failed to read clipboard:",e)}if(!n)return;const t=Te();if(!t){console.error("[SahAI] Could not find input field to paste");return}if(t.focus(),t instanceof HTMLTextAreaElement){const e=t.selectionStart||0,o=t.selectionEnd||0,s=t.value;t.value=s.substring(0,e)+n+s.substring(o),t.selectionStart=t.selectionEnd=e+n.length,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}else try{document.execCommand("insertText",!1,n)}catch(e){console.error("[SahAI] Standard insertText failed, trying direct innerText update",e),t.innerText=n,t.dispatchEvent(new Event("input",{bubbles:!0}))}console.log("[SahAI] Successfully pasted content"),O=null,Oe()}function q(){const n=document.getElementById("pe-zone1");n&&n.remove();const t=Q();t&&(t.style.display="",t.style.flexDirection="",t.style.alignItems="",t.style.gap="");const e=document.getElementById("pe-styles");e&&e.remove()}let te=()=>{};function $e(){let n=0;const t=10,e=()=>{document.getElementById("pe-zone1")||($(),!document.getElementById("pe-zone1")&&n<t&&(n++,setTimeout(e,500)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):setTimeout(e,500);let o=location.href,s=!1,c=!1;const i=()=>{if(s)return;s=!0,(window.requestIdleCallback||(l=>setTimeout(l,100)))(()=>{var ne,se;s=!1,location.href!==o&&(o=location.href,console.log("[SahAI] URL change detected"));const l=window.location.href,u=l.includes("/c/")||l.includes("/chat/")||l.includes("/thread/"),d=new URL(l),w=(d.hostname.includes("chatgpt.com")||d.hostname.includes("openai.com"))&&(d.pathname==="/"||d.pathname==="");let qe=!!p&&p!=="generic",C=!1;if(p==="claude"?C=window.location.pathname.includes("/chat"):p==="chatgpt"?C=u||w:C=!0,qe){const Ne=!!document.getElementById("pe-zone1");!!document.getElementById("pe-figma-pill-container")&&((ne=document.getElementById("pe-figma-pill-container"))==null||ne.remove()),!Ne&&C&&m&&$()}else(document.getElementById("pe-zone1")||document.getElementById("pe-figma-pill-container"))&&(console.log("[SahAI] Removing buttons: No longer on supported platform"),q(),(se=document.getElementById("pe-figma-pill-container"))==null||se.remove());const N=m?m.scrapePrompts().length>0:!1;N!==c&&(c=N,chrome.runtime.sendMessage({action:"STATUS_RESULT",supported:!!m,platform:p,hasPrompts:N}))},{timeout:2e3})};te=i,new MutationObserver(r=>{r.some(u=>u.type==="childList"&&u.addedNodes.length>0)&&i()}).observe(document.documentElement,{childList:!0,subtree:!0}),i()}chrome.runtime.onMessage.addListener((n,t,e)=>{switch(console.log("[SahAI] Received message:",n.action),n.action){case"URL_CHANGED":{console.log("[SahAI] URL changed, resetting session"),ve(),g=[],_(),document.getElementById("pe-zone1")&&q(),setTimeout(()=>{te(),E(),T()},500),e({success:!0});break}case"EXTRACT_PROMPTS":{if(R)return console.warn("[SahAI] Extraction already in progress, ignoring request"),e({success:!1,error:"Extraction already in progress. Please wait."}),!0;const o=n.mode,s=n.extractionSource||"auto";R=!0;const c=document.getElementById("pe-extract-btn"),i=c&&c.textContent||"Capture";return c&&Y(c),j(s).then(a=>{const r=K(a);chrome.runtime.sendMessage({action:"EXTRACTION_RESULT",result:r,mode:o}),c&&J(c,i),e({success:!0,promptCount:a.length})}).catch(a=>{console.error("[SahAI] Extraction failed:",a),c&&(c.textContent="Error",setTimeout(()=>{c.classList.remove("loading"),c.textContent=i},2e3)),e({success:!1,error:a.message})}).finally(()=>{R=!1}),!0}case"GET_STATUS":{e({action:"STATUS_RESULT",supported:!!m,platform:p,hasPrompts:m?m.scrapePrompts().length>0:!1});break}case"TOGGLE_BUTTONS":{n.visible?$():q(),e({success:!0});break}case"CONTENT_COPIED":{O=n.content,Re(),e({success:!0});break}default:e({success:!1,error:"Unknown action"})}return!0}),D(),$e(),Ie()})();

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pricing.js","./firebase.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty;var we=(l,n,r)=>n in l?Ce(l,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[n]=r;var E=(l,n,r)=>we(l,typeof n!="symbol"?n+"":n,r);import{g as Ne,i as Se,s as Te,a as Pe,b as Ee}from"./auth.js";import{r as a,j as e,c as Ie}from"./vendor.js";import{r as Ae,c as Me,g as Le,m as Ue,s as Re}from"./firebase.js";import{_ as He}from"./preload-helper.js";import{PRO_PRICING as Fe,getUserTier as X,incrementCompile as Be,incrementCapture as _e,canUserCompile as De,canUserCapture as ze}from"./pricing.js";class Ge{constructor(){E(this,"queue",[]);E(this,"enabled",!1);E(this,"consentGiven",!1);typeof chrome<"u"&&chrome.storage&&(chrome.storage.local.get("telemetryConsent",n=>{this.consentGiven=!!n.telemetryConsent,this.enabled=this.consentGiven}),chrome.storage.onChanged.addListener((n,r)=>{r==="local"&&n.telemetryConsent&&(this.consentGiven=n.telemetryConsent.newValue,this.enabled=this.consentGiven)})),(typeof window<"u"||typeof self<"u")&&setInterval(()=>this.flush(),6e4)}setConsent(n){this.consentGiven=n,this.enabled=n,chrome.storage.local.set({telemetryConsent:n}),n||(this.queue=[])}track(n,r={}){!this.enabled||!this.consentGiven||(this.queue.push({event:n,timestamp:Date.now(),data:{...r,version:chrome.runtime.getManifest().version}}),(n.includes("error")||n.includes("crash")||n.includes("failure"))&&this.flush())}async flush(){if(this.queue.length===0)return;if(!this.consentGiven){this.queue=[];return}const n=[...this.queue];this.queue=[];try{const r=await Ne(),i=(await chrome.storage.session.get("firebase_current_user_id")).firebase_current_user_id,x={"Content-Type":"application/json"};r&&(x.Authorization=`Bearer ${r}`),i&&(x["X-User-Id"]=i),await Ae(`${Me.backend.url}/telemetry`,{method:"POST",headers:x,body:JSON.stringify({events:n})})}catch{n.length<100&&(this.queue=[...n,...this.queue].slice(0,100))}}}const Oe=new Ge;class We extends a.Component{constructor(r){super(r);E(this,"handleReset",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,b){var i,x;console.error("[ErrorBoundary] Caught error:",r,b),Oe.track("ui_crash",{error:r.message,stack:(i=r.stack)==null?void 0:i.slice(0,500),component:(x=b.componentStack)==null?void 0:x.slice(0,200)})}render(){var r;return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"error-boundary-container",children:[e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-boundary-emoji",children:"ðŸ˜µ"}),e.jsx("h2",{className:"error-boundary-title",children:"Something went wrong"}),e.jsx("p",{className:"error-boundary-desc",children:((r=this.state.error)==null?void 0:r.message)||"An unexpected error occurred"}),e.jsx("button",{onClick:this.handleReset,className:"btn-primary",children:"Try Again"})]}),e.jsx("style",{children:`
            .error-boundary-container {
              display: flex;
              align-items: center;
              justify-content: center;
              height: 100vh;
              padding: 24px;
              text-align: center;
              background: var(--bg-primary);
              color: var(--text-primary);
            }
            .error-boundary-emoji {
              font-size: 48px;
              margin-bottom: 16px;
            }
            .error-boundary-title {
              font-size: 20px;
              font-weight: 700;
              margin-bottom: 8px;
            }
            .error-boundary-desc {
              font-size: 14px;
              color: var(--text-secondary);
              margin-bottom: 24px;
              max-width: 300px;
            }
          `})]}):this.props.children}}function qe({currentTier:l,onSignIn:n,onUpgradeToPro:r,onClose:b}){return l==="guest"?e.jsx("div",{className:"upgrade-modal",children:e.jsxs("div",{className:"upgrade-content",children:[e.jsx("button",{className:"upgrade-close",onClick:b,children:"Ã—"}),e.jsxs("div",{className:"upgrade-header",children:[e.jsx("h3",{children:"ðŸš€ Unlock Go Tier (Free!)"}),e.jsxs("p",{children:["You're on Basic. Sign in to get ",e.jsx("b",{children:"Unlimited Captures"})," and more for FREE!"]})]}),e.jsxs("div",{className:"upgrade-features",style:{margin:"24px 0"},children:[e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"âœ¨"}),e.jsx("span",{children:"Unlimited content captures"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"â˜ï¸"}),e.jsx("span",{children:"History & Sync across devices"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ“"}),e.jsx("span",{children:"Pin your favorite prompts"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"âš¡"}),e.jsx("span",{children:"10 Compiles per day"})]})]}),e.jsxs("button",{className:"kb-google-btn",onClick:n,style:{width:"100%",marginTop:8},children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-1 .67-2.28 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.67-.35-1.39-.35-2.09s.13-1.42.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.66l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Sign in & Upgrade to Go"]})]})}):l==="free"||l==="go"?e.jsx("div",{className:"upgrade-modal",children:e.jsxs("div",{className:"upgrade-content",children:[e.jsx("button",{className:"upgrade-close",onClick:b,children:"Ã—"}),e.jsxs("div",{className:"upgrade-header",children:[e.jsx("h3",{children:"â­ Upgrade to Pro"}),e.jsx("div",{className:"pricing-display",children:e.jsxs("span",{className:"price-new",children:["$",Fe.regularPrice,"/month"]})}),e.jsx("p",{children:"Get unlimited power and advanced control."})]}),e.jsxs("div",{className:"upgrade-features",style:{margin:"24px 0"},children:[e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"âš¡"}),e.jsxs("span",{children:[e.jsx("b",{children:"Unlimited"})," session compiles"]})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ§ "}),e.jsx("span",{children:"Access to Advanced Models"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ› ï¸"}),e.jsx("span",{children:"Custom DOM & API options"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ’¬"}),e.jsx("span",{children:"Priority Support"})]})]}),e.jsx("button",{className:"kb-btn-primary",onClick:r,style:{width:"100%",padding:"12px",height:"48px"},children:"Upgrade to Pro"}),e.jsx("p",{className:"upgrade-note",children:"Cancel anytime"})]})}):null}function $e(){const[l,n]=a.useState(null),[r,b]=a.useState("free"),[i,x]=a.useState(null),[C,w]=a.useState("capture"),[le,g]=a.useState(!1),[R,k]=a.useState({supported:!1,platform:null}),[H,F]=a.useState(!1),[I,A]=a.useState(!1),[ce,M]=a.useState([]),[B,L]=a.useState(!1),[y,_]=a.useState([]),[de,N]=a.useState(!1),[Y,he]=a.useState("auto"),[D,ue]=a.useState(!1),[S,z]=a.useState("all"),[G,J]=a.useState(!1),[K,T]=a.useState(null),[Z,O]=a.useState(!1),[W,Q]=a.useState(null),[ee,pe]=a.useState(null),[U,se]=a.useState(!1),[te,re]=a.useState(0),q=a.useRef(0),j=a.useRef(null);a.useEffect(()=>{Se().then(h=>n(h.user));const t=Te(h=>n(h)),s=()=>{chrome.tabs.query({active:!0,currentWindow:!0},h=>{const m=h[0];if(m!=null&&m.id){const u=m.url||"";let c=null;u.includes("chatgpt.com")?c="chatgpt":u.includes("claude.ai")?c="claude":u.includes("deepseek.com")?c="deepseek":u.includes("perplexity.ai")?c="perplexity":u.includes("meta.ai")?c="meta-ai":u.includes("gemini.google.com")&&(c="gemini");try{chrome.tabs.sendMessage(m.id,{action:"GET_STATUS"},P=>{chrome.runtime.lastError?k(c?{supported:!1,platform:c}:{supported:!1,platform:null}):k(P||{supported:!1,platform:null})})}catch{k(c?{supported:!1,platform:c}:{supported:!1,platform:null})}}})},o=setInterval(s,1e3);s();const d=()=>s(),p=(h,m,u)=>{u.active&&s()};return chrome.tabs.onActivated.addListener(d),chrome.tabs.onUpdated.addListener(p),()=>{t(),clearInterval(o),j.current&&clearInterval(j.current),chrome.tabs.onActivated.removeListener(d),chrome.tabs.onUpdated.removeListener(p)}},[]),a.useEffect(()=>{(async()=>{const s=await X();b(s)})()},[l]);const ie=async()=>{const s=(await chrome.storage.local.get("history")).history||[];if(M(s),A(!0),L(!1),l)try{const o=await Le(l.id),d=Ue(s,o);M(d)}catch{}},ne=()=>{const t=Date.now();q.current=t,re(0),j.current&&clearInterval(j.current),j.current=setInterval(()=>{const s=(Date.now()-t)/1e3;re(parseFloat(s.toFixed(1)))},100)},$=()=>{j.current&&(clearInterval(j.current),j.current=null)};a.useEffect(()=>{const t=async s=>{var o,d;if(s.action==="EXTRACTION_RESULT"||s.action==="EXTRACTION_FROM_PAGE_RESULT"){if(s.error?T(s.error):T(null),Z&&s.error){O(!1),g(!1),T(s.error),$();return}if(s.mode==="compile"&&!s.result.summary&&!s.error){console.log("[Sidepanel] Received raw compile result, waiting for AI..."),x(s.result);return}O(!1),x(s.result),w(s.mode||"capture"),g(!1),$(),A(!1),F(!0);const p=q.current?parseFloat(((Date.now()-q.current)/1e3).toFixed(1)):0;Q(p);const h={id:Date.now().toString(),timestamp:Date.now(),platform:((o=s.result.metadata)==null?void 0:o.platform)||s.result.platform||"Unknown",promptCount:s.result.prompts.length,preview:s.result.summary?s.result.summary.substring(0,100)+"...":(((d=s.result.prompts[0])==null?void 0:d.content)||"").substring(0,100)+"...",prompts:s.result.prompts,summary:s.result.summary,model:s.result.model,provider:s.result.provider,mode:s.mode||"capture",duration:p,isPinned:!1};pe(h.id),se(!1);const{history:m=[]}=await chrome.storage.local.get("history"),u=[h,...m].slice(0,50);await chrome.storage.local.set({history:u}),M(u),l&&await Re(l.id,h),s.mode==="compile"?await Be():await _e();const c=await X();b(c)}else s.action==="STATUS_RESULT"?k({supported:s.supported,platform:s.platform}):s.action==="ERROR"?(T(s.error),g(!1),$()):s.action==="EXTRACT_TRIGERED_FROM_PAGE"&&(g(!0),ne(),w(s.mode||"capture"))};return chrome.runtime.onMessage.addListener(t),()=>chrome.runtime.onMessage.removeListener(t)},[l,r]);const V=async()=>{try{await Ee()}catch(t){console.error("[UI] Login failed:",t),alert(`Login Failed: ${t.message||"Please check your connection or Extension ID"}`)}},oe=async t=>{let s;if(t==="compile"?s=await De():s=await ze(),!s.allowed){N(!0);return}w(t),g(!0),ne(),chrome.tabs.query({active:!0,currentWindow:!0},o=>{var d;(d=o[0])!=null&&d.id&&chrome.tabs.sendMessage(o[0].id,{action:"EXTRACT_PROMPTS",mode:t,extractionSource:Y})})},ae=async()=>{const t=o=>o.replace(/\n\nâš¡ Summary by .*$/,""),s=y.length>0?y.map(o=>t((i==null?void 0:i.prompts[o].content)||"")).join(`

`):i==null?void 0:i.prompts.map(o=>t(o.content)).join(`

`);s&&await navigator.clipboard.writeText(s)},me=()=>{if(!i||y.length===0)return;const t=i.prompts.filter((s,o)=>!y.includes(o));x({...i,prompts:t}),_([])},xe=t=>{_(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},fe=async()=>{if(r==="guest"||!ee)return;const t=!U;se(t);const d=((await chrome.storage.local.get("history")).history||[]).map(p=>p.id===ee?{...p,isPinned:t}:p);await chrome.storage.local.set({history:d}),M(d)},be=t=>{const s=[],o=t.filter(f=>f.isPinned);o.length>0&&s.push({label:"Pinned",items:o});const p=t.filter(f=>!f.isPinned).filter(f=>S==="all"?!0:f.mode===S),h=new Date;h.setHours(0,0,0,0);const m=new Date(h);m.setDate(m.getDate()-1);const u=p.filter(f=>{const v=new Date(f.timestamp);return v.setHours(0,0,0,0),v.getTime()===h.getTime()});u.length>0&&s.push({label:"Today",items:u});const c=p.filter(f=>{const v=new Date(f.timestamp);return v.setHours(0,0,0,0),v.getTime()===m.getTime()});c.length>0&&s.push({label:"Yesterday",items:c});const P=p.filter(f=>{const v=new Date(f.timestamp);return v.setHours(0,0,0,0),v.getTime()<m.getTime()});return P.length>0&&s.push({label:"Earlier",items:P}),s},ge=()=>e.jsxs("div",{className:"kb-header-icons",children:[r!=="guest"&&e.jsx("button",{className:"kb-icon-button",onClick:ie,title:"History",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsx("button",{className:"kb-icon-button",onClick:()=>L(!B),title:"Profile",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:l?"currentColor":"none",stroke:"currentColor",strokeWidth:l?"0":"2",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]}),ye=()=>e.jsxs("div",{className:"kb-screen-content",children:[e.jsxs("h1",{className:"kb-title-large",children:["This page",e.jsx("br",{}),"is not",e.jsx("br",{}),"supported"]}),e.jsxs("p",{className:"kb-text-body",style:{marginBottom:16},children:["Please navigate to a ",e.jsx("a",{href:"#",onClick:()=>N(!0),style:{color:"var(--kb-primary-blue)",textDecoration:"none",fontWeight:600},children:"supported site"})," to use this extension."]}),e.jsxs("p",{className:"kb-link-text",children:["Try ",e.jsx("a",{href:"#",onClick:()=>chrome.tabs.create({url:"https://chatgpt.com"}),style:{color:"inherit"},children:"ChatGPT"}),", ",e.jsx("a",{href:"#",onClick:()=>chrome.tabs.create({url:"https://claude.ai"}),style:{color:"inherit"},children:"Claude"}),", or ",e.jsx("a",{href:"#",onClick:()=>chrome.tabs.create({url:"https://chat.deepseek.com"}),style:{color:"inherit"},children:"DeepSeek"}),"."]})]}),je=()=>e.jsxs("div",{className:"kb-screen-content",children:[e.jsxs("h1",{className:"kb-title-large",children:["Connection",e.jsx("br",{}),"Lost"]}),e.jsx("p",{className:"kb-text-body",children:"Handshake missing. Please refresh to continue."}),e.jsx("button",{className:"kb-btn-refresh",onClick:()=>chrome.tabs.query({active:!0,currentWindow:!0},t=>{var s;return((s=t[0])==null?void 0:s.id)&&chrome.tabs.reload(t[0].id)}),children:"Refresh"}),e.jsx("div",{className:"kb-shortcut-hint",children:navigator.platform.includes("Mac")?"Cmd + R":"Ctrl + R"})]}),ve=()=>e.jsxs("div",{className:"kb-screen-content",children:[e.jsxs("h1",{className:"kb-title-large",children:["One Click",e.jsx("br",{}),"Away"]}),e.jsxs("p",{className:"kb-text-body",children:["Connected to ",R.platform||"AI Chat",".",e.jsx("br",{}),"Choose a mode to begin."]}),e.jsxs("div",{className:"kb-action-card",onClick:()=>oe("capture"),children:[e.jsx("span",{className:"kb-card-label",children:"Capture"}),e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5l7 7-7 7"})]})]}),e.jsxs("div",{className:"kb-action-card",onClick:()=>oe("compile"),children:[e.jsx("span",{className:"kb-card-label",children:"Compile"}),e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5l7 7-7 7"})]})]}),(r==="pro"||r==="infi"||r==="admin")&&e.jsxs("div",{style:{width:"100%",marginTop:24},children:[e.jsxs("button",{onClick:()=>ue(!D),style:{background:"none",border:"none",color:"var(--kb-logo-vibrant)",fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:4,margin:"0 auto"},children:["Advanced Options ",D?"â–²":"â–¼"]}),D&&e.jsxs("div",{style:{marginTop:12,background:"rgba(0,0,0,0.03)",padding:12,borderRadius:8,fontSize:12,textAlign:"left"},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontWeight:600,marginBottom:4},children:"Extraction Mode"}),e.jsxs("select",{value:Y,onChange:t=>he(t.target.value),style:{width:"100%",padding:4,borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("option",{value:"auto",children:"Auto (Best)"}),e.jsx("option",{value:"dom",children:"DOM Only (Scrape)"}),e.jsx("option",{value:"keylog",children:"Keylog Only (Live)"})]})]}),e.jsxs("div",{style:{borderTop:"1px solid rgba(0,0,0,0.05)",paddingTop:8,display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("div",{style:{opacity:.6,display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"ðŸ§ "})," Advanced Models",e.jsx("span",{style:{fontSize:10,background:"#eee",padding:"2px 4px",borderRadius:4},children:"Coming Soon"})]}),e.jsxs("div",{style:{opacity:.6,display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"ðŸ’¬"})," Priority Support",e.jsx("span",{style:{fontSize:10,background:"#eee",padding:"2px 4px",borderRadius:4},children:"Active"})]})]})]})]})]}),ke=()=>e.jsxs("div",{className:"kb-results-wrapper",children:[e.jsxs("div",{className:"kb-results-header",children:[e.jsx("button",{className:"kb-back-circle",onClick:()=>{y.length>0?_([]):F(!1)},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),e.jsxs("div",{className:"kb-mode-pill",children:[C==="compile"?"Compile":"Capture",C==="compile"&&e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})]}),e.jsx("div",{style:{width:40}})," "]}),e.jsxs("div",{className:"kb-stats-bar",children:[e.jsxs("div",{className:"kb-stats-text",style:{marginBottom:0},children:["Captured ",(i==null?void 0:i.prompts.length)||0," prompts in ",(W==null?void 0:W.toFixed(0))||te.toFixed(0)," s"]}),r!=="guest"&&e.jsx("button",{className:`kb-pin-btn ${U?"active":""}`,onClick:fe,title:U?"Unpin":"Pin to top",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:U?"currentColor":"var(--kb-text-secondary)",xmlns:"http://www.w3.org/2000/svg",style:{transform:"rotate(45deg)"},children:e.jsx("path",{d:"M16 9V4h1c0.55 0 1-0.45 1-1s-0.45-1-1-1H7C6.45 2 6 2.45 6 3s0.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"})})})]}),e.jsxs("div",{className:"kb-results-card",children:[C==="compile"&&(i!=null&&i.summary)?e.jsxs("div",{className:"kb-summary-section",children:[e.jsx("div",{className:"kb-summary-content",children:i.summary}),i.summary.includes("Local Client-Side Logic")&&e.jsxs("div",{style:{marginTop:12},children:[K&&e.jsxs("div",{style:{fontSize:11,color:"#EF4444",background:"#FFF1F1",padding:"8px 12px",borderRadius:8,marginBottom:12,border:"1px solid rgba(239, 68, 68, 0.2)"},children:[e.jsx("strong",{children:"Cloud AI Error:"})," ",K]}),e.jsx("button",{className:"kb-footer-btn-secondary",style:{width:"100%",borderRadius:12,padding:"8px 0",fontSize:13},onClick:async()=>{g(!0),O(!0),T(null),chrome.runtime.sendMessage({action:"RE_SUMMARIZE"})},children:Z?"âœ¨ Refining...":"âœ¨ Refine with Cloud AI"})]}),e.jsx("div",{style:{borderTop:"1px solid var(--kb-border)",marginTop:16,paddingTop:12},children:e.jsxs("button",{className:"kb-link-btn",onClick:()=>{w("capture")},children:["View full list of prompts (",i.prompts.length,")"]})})]}):e.jsx("div",{className:"kb-results-scroll",children:i==null?void 0:i.prompts.map((t,s)=>e.jsxs("div",{className:`kb-result-item ${y.includes(s)?"selected":""}`,onClick:()=>xe(s),children:[y.includes(s)&&e.jsx("div",{className:"kb-selection-dot"}),e.jsx("div",{className:"kb-card-body",children:t.content})]},s))}),e.jsx("div",{className:"kb-card-footer",children:C==="compile"&&(i!=null&&i.summary)?e.jsx("button",{className:"kb-footer-btn-primary",onClick:()=>{i!=null&&i.summary&&(chrome.runtime.sendMessage({action:"COPY_TEXT",text:i.summary}),J(!0),setTimeout(()=>J(!1),2e3))},children:G?"Copied!":"Copy Summary"}):y.length>0?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"kb-footer-btn-secondary",onClick:me,children:"Delete"}),e.jsx("div",{className:"kb-footer-divider"}),e.jsx("button",{className:"kb-footer-btn-primary",onClick:ae,children:G?"Copied!":`Copy (${y.length})`})]}):e.jsx("button",{className:"kb-footer-btn-primary",onClick:ae,children:G?"Copied!":"Copy"})})]}),e.jsx("div",{className:"kb-disclaimer",children:"Please verify content before use."})]});return e.jsxs("div",{className:"kb-app-container",children:[!H&&!I&&ge(),(H||I)&&e.jsxs("div",{className:"kb-header-icons",children:[!I&&r!=="guest"&&e.jsx("button",{className:"kb-icon-button",onClick:()=>ie(),title:"History",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsx("button",{className:"kb-icon-button",onClick:()=>L(!B),title:"Profile",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:l?"currentColor":"none",stroke:"currentColor",strokeWidth:l?"0":"2",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]}),le&&e.jsxs("div",{style:{position:"fixed",inset:0,background:"rgba(255,255,255,0.8)",zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx("div",{className:"kb-spinner",style:{width:32,height:32,border:"3px solid #E5E7EB",borderTopColor:"var(--kb-logo-vibrant)",borderRadius:"50%"}}),e.jsxs("p",{style:{marginTop:16,color:"var(--kb-text-secondary)",fontWeight:500},children:[C==="compile"?"Compiling...":"Capturing..."," ",te.toFixed(1),"s"]})]}),I?e.jsxs("div",{className:"kb-history-overlay kb-fade-in",children:[e.jsxs("div",{className:"kb-results-header",children:[e.jsx("button",{className:"kb-back-circle",onClick:()=>A(!1),children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),e.jsx("h2",{style:{fontSize:18,fontWeight:700},children:"History"}),e.jsx("div",{style:{width:40}})]}),e.jsxs("div",{className:"kb-history-filters",style:{display:"flex",gap:8,padding:"0 16px 12px",overflowX:"auto",scrollbarWidth:"none"},children:[e.jsx("button",{className:`kb-filter-pill ${S==="all"?"active":""}`,onClick:()=>z("all"),children:"All"}),e.jsx("button",{className:`kb-filter-pill ${S==="capture"?"active":""}`,onClick:()=>z("capture"),children:"Capture"}),e.jsx("button",{className:`kb-filter-pill ${S==="compile"?"active":""}`,onClick:()=>z("compile"),children:"Compile"})]}),r==="guest"?e.jsxs("div",{className:"kb-screen-content",children:[e.jsx("h3",{children:"History Locked"}),e.jsx("p",{children:"Sign in to access your prompt history!"}),e.jsx("button",{className:"kb-btn-primary",onClick:V,children:"Sign In"})]}):e.jsx("div",{className:"kb-history-list",children:be(ce).map(t=>e.jsxs("div",{children:[e.jsx("div",{className:"kb-history-separator",children:t.label}),t.items.map(s=>e.jsxs("div",{className:"kb-history-card-premium",onClick:()=>{x({prompts:s.prompts,platform:s.platform,url:"",title:"History Item",extractedAt:s.timestamp,summary:s.summary,model:s.model,provider:s.provider}),Q(s.duration||0),w(s.mode||"capture"),A(!1),F(!0)},children:[e.jsxs("div",{className:"kb-history-card-top",children:[e.jsx("div",{className:"kb-history-platform-pill",children:!s.platform||s.platform==="unknown"?"LEGACY":s.platform.toUpperCase()}),e.jsxs("div",{className:"kb-history-meta",children:[s.isPinned&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"var(--kb-logo-vibrant)",style:{transform:"rotate(45deg)"},children:e.jsx("path",{d:"M16 12V4H8v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})}),e.jsx("span",{className:"kb-history-date",children:new Date(s.timestamp).toLocaleDateString()})]})]}),e.jsx("div",{className:"kb-history-card-preview",children:s.preview}),e.jsx("div",{className:"kb-history-card-bottom",children:e.jsxs("span",{className:"kb-history-count",children:[s.promptCount," prompts"]})})]},s.id))]},t.label))})]}):H?ke():R.platform?R.supported?ve():je():ye(),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"kb-popup-backdrop",onClick:()=>L(!1)}),e.jsx("div",{className:"kb-profile-menu kb-fade-in",onClick:t=>t.stopPropagation(),children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"kb-menu-item",style:{borderBottom:"1px solid #F3F4F6",marginBottom:4,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:600},children:l.name||"User"}),e.jsxs("div",{style:{fontSize:12,color:"var(--kb-text-secondary)"},children:[r==="guest"?"Basic":r==="free"||r==="go"?"Go":"Pro"," Plan"]})]}),(r==="free"||r==="go")&&e.jsxs("div",{className:"kb-menu-item",style:{color:"var(--kb-logo-vibrant)"},onClick:()=>N(!0),children:[e.jsx("div",{style:{fontWeight:600},children:"Upgrade to PRO ðŸš€"}),e.jsx("div",{style:{fontSize:11,color:"#60A5FA"},children:"Unlimited Compiles & More"})]}),e.jsx("div",{className:"kb-menu-item",style:{color:"#EF4444",marginTop:4},onClick:()=>Pe(),children:"Sign Out"})]}):e.jsxs("div",{className:"kb-menu-item",onClick:V,style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("div",{style:{fontWeight:600},children:"Login with Google"}),e.jsx("div",{style:{fontSize:11,color:"var(--kb-text-secondary)"},children:"Unlock Go Tier (Free!)"})]})})]}),de&&e.jsx(qe,{currentTier:r,onSignIn:V,onUpgradeToPro:async()=>{g(!0);try{const{invalidateTierCache:t}=await He(async()=>{const{invalidateTierCache:o}=await import("./pricing.js");return{invalidateTierCache:o}},__vite__mapDeps([0,1]),import.meta.url);await t(),await new Promise(o=>setTimeout(o,1500)),await chrome.storage.local.set({userTier:"pro"});const s=await X();b(s),g(!1),N(!1),alert("âœ… Upgrade Successful! (Simulation Mode)")}catch(t){console.error("Upgrade error:",t),g(!1),alert("âŒ Upgrade failed. Please try again.")}},onClose:()=>N(!1)})]})}const Ve=Ie.createRoot(document.getElementById("root"));Ve.render(e.jsx(We,{children:e.jsx($e,{})}));
